#!/bin/bash

# sanity
if [ "x$1" == x ]; then
	echo no base directory specified
	exit 1
fi

# create folders
base=$1
shift

# configure arm targets
targets="arm-gba arm-integrator arm-integrator-nommu"
./configure --build=$base/arm-gba --target=arm-gba \
    --cross-compile=arm-elf- $* || exit 1
./configure --build=$base/arm-integrator --target=arm-integrator \
    --cross-compile=arm-elf- $* || exit 1
./configure --build=$base/arm-integrator-nommu --target=arm-integrator \
    --cross-compile=arm-elf- --profile=nommu $* || exit 1

# configure i386 targets
targets="$targets i386-pc i386-pc-tiny"
./configure --build=$base/i386-pc --target=i386-pc \
    --cross-compile=i386-elf- $* || exit 1
./configure --build=$base/i386-pc-tiny --target=i386-pc \
    --cross-compile=i386-elf- --profile=tiny $* || exit 1

# create top level make file
echo "# Autogenerated by allconfig" > $base/Makefile
echo "SRCDIR = `pwd`" >> $base/Makefile
echo "TARGETS = $targets" >> $base/Makefile
cat >> $base/Makefile <<"MAKEFILE"

ifdef MAKECMDGOALS
$(MAKECMDGOALS): $(TARGETS)

else
all: $(TARGETS)

endif

.PHONY: $(TARGETS)
$(TARGETS):
	$(MAKE) -C $@ $(MAKECMDGOALS)

MAKEFILE
